# インフラ方式設計

## 概要

- Slack（シアトル用ワークスペース）でありがとうスタンプを押した際に、押した側と押された側にトークンを発行するアプリケーションの開発。

- 社内運用を考えている為、サーバーを稼働させておく必要あり。責任範囲を狭くしつつコストを抑える様にする為、今回はAWS上へのデプロイを検討。

- Lambdaのトリガーは豊島君の調査結果を元に検討。
 - Slack app（チャットボット）を開発。
  - スタンプを押した際にトークン発行のAPIを叩く流れ。

## 使用リソース詳細

- AWS
  - VPC 
    - subnet
      - EC2(t3.small) - イーサリアムのプライベートチェーンを構築
      - Lambda        - Slack連携用のAPIサーバーを構築
      - NAT           - DMZ配置用
      - EIP           - NAT用パブリックIP
      - SG            - NATのみ許可予定
    - IGW             - 外部ネット接続用
    - ルーティングテーブル                - VPC内でのトラフィックのルール決め
    - セッションマネージャー用エンドポイント - EC2接続用のエンドポイント
    - API Gateway - Lambda用のエンドポイント

- Slack
  - Slack App    - slackのスタンプをトリガーに、APIを叩く。
  - Slack App    - slackのチャンネルにトークン所有情報を表示。s
  

- 同一VPC内に構築しセキュアな環境を構築しイントラネット化を行う。下記リソースは要検討。

- Cognito     - ログイン機能
- S3          - フロントサイト構築

## 構築手順

- Lambda以外はTerrafomrで構築。Lambdaはserverlessで構築。
- dev,stg,prod用のterraformとserverlessは用意するが、デプロイはdevのみで開始。
- 設計が固まってきたら他環境も検討。

#### 1  
  - terraformでVPC構築後にserverlessでLambda構築
#### 2
  - 作成したEC2内にセッションマネージャーで入り、イーサリアムのプライベートチェーン構築

